<!DOCTYPE html>
<html lang="en">
 <head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <title>Advanced Hybrid Scheduler</title>
   <style>
     * {
       margin: 0;
       padding: 0;
       box-sizing: border-box;
     }

     body {
       font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
       background: #121212;
       color: #e0e0e0;
       min-height: 100vh;
       padding: 20px;
     }

     .container {
       max-width: 1400px;
       margin: 0 auto;
       background: #1e1e1e;
       border-radius: 20px;
       box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
       overflow: hidden;
     }

     .header {
       background: linear-gradient(135deg, #0052d4 0%, #4364f7 100%);
       color: white;
       padding: 30px;
       text-align: center;
     }

     .header h1 {
       font-size: 2.5em;
       margin-bottom: 10px;
     }

     .header p {
       opacity: 0.9;
       font-size: 1.1em;
     }

     .content {
       padding: 30px;
     }

     .priority-rule-section {
       background: #2a2a2a;
       padding: 25px;
       border-radius: 15px;
       margin-bottom: 30px;
       border: 2px solid #0052d4;
     }

     .priority-rule-section h3 {
       color: #f0f0f0;
       margin-bottom: 15px;
       font-size: 1.3em;
     }

     .radio-group {
       display: flex;
       gap: 30px;
       flex-wrap: wrap;
     }

     .radio-option {
       display: flex;
       align-items: center;
       gap: 10px;
       padding: 15px 20px;
       background: #333;
       border: 2px solid #555;
       border-radius: 10px;
       cursor: pointer;
       transition: all 0.3s;
     }

     .radio-option:hover {
       border-color: #4364f7;
       transform: translateY(-2px);
       box-shadow: 0 4px 8px rgba(67, 100, 247, 0.3);
     }

     .radio-option input[type="radio"] {
       width: 20px;
       height: 20px;
       cursor: pointer;
     }

     .radio-option.selected {
       border-color: #4364f7;
       background: linear-gradient(135deg, #0052d415 0%, #4364f715 100%);
     }

     .radio-option label {
       cursor: pointer;
       font-weight: 500;
       font-size: 1.05em;
       color: #e0e0e0;
     }

     .input-section {
       background: #2a2a2a;
       padding: 25px;
       border-radius: 15px;
       margin-bottom: 30px;
     }

     .input-header {
       display: flex;
       justify-content: space-between;
       align-items: center;
       margin-bottom: 20px;
     }

     .input-header h2 {
       color: #f0f0f0;
       font-size: 1.5em;
     }

     .btn {
       padding: 10px 20px;
       border: none;
       border-radius: 8px;
       cursor: pointer;
       font-size: 1em;
       font-weight: 600;
       transition: all 0.3s;
     }

     .btn-primary {
       background: linear-gradient(135deg, #0052d4 0%, #4364f7 100%);
       color: white;
     }

     .btn-primary:hover {
       transform: translateY(-2px);
       box-shadow: 0 5px 15px rgba(67, 100, 247, 0.3);
     }

     .btn-success {
       background: #10b981;
       color: white;
       font-size: 1.1em;
       padding: 12px 30px;
     }

     .btn-success:hover {
       background: #059669;
       transform: translateY(-2px);
       box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
     }

     .btn-secondary {
       background: #6c757d;
       color: white;
     }

     .btn-secondary:hover {
       background: #5a6268;
     }

     .process-table {
       width: 100%;
       border-collapse: collapse;
       margin-top: 20px;
     }

     .process-table th {
       background: #0052d4;
       color: white;
       padding: 12px;
       text-align: left;
       font-weight: 600;
     }

     .process-table td {
       padding: 12px;
       border-bottom: 1px solid #444;
     }

     .process-table input {
       width: 100%;
       padding: 8px;
       background: #333;
       color: #fff;
       border: 2px solid #555;
       border-radius: 6px;
       font-size: 0.95em;
     }

     .process-table input:focus {
       outline: none;
       border-color: #4364f7;
     }

     .process-table tr:hover {
       background: #333333;
     }

     .delete-btn {
       background: #ef4444;
       color: white;
       border: none;
       padding: 8px 12px;
       border-radius: 6px;
       cursor: pointer;
     }

     .delete-btn:hover {
       background: #dc2626;
     }

     .results-section {
       display: none;
       animation: fadeIn 0.5s;
     }

     @keyframes fadeIn {
       from {
         opacity: 0;
         transform: translateY(20px);
       }
       to {
         opacity: 1;
         transform: translateY(0);
       }
     }

     .gantt-container {
       background: #2a2a2a;
       padding: 25px;
       border-radius: 15px;
       margin-bottom: 30px;
     }

     .gantt-container h3 {
       color: #f0f0f0;
       margin-bottom: 20px;
       font-size: 1.3em;
     }

     .gantt-chart {
       display: flex;
       height: 60px;
       border-radius: 8px;
       overflow: hidden;
       box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
     }

     .gantt-block {
       display: flex;
       align-items: center;
       justify-content: center;
       color: white;
       font-weight: bold;
       border-right: 2px solid #1e1e1e;
       transition: transform 0.2s;
     }

     .gantt-block:hover {
       transform: scaleY(1.1);
       z-index: 10;
     }

     .metrics-grid {
       display: grid;
       grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
       gap: 20px;
       margin-bottom: 30px;
     }

     .metric-card {
       background: linear-gradient(135deg, #0052d4 0%, #4364f7 100%);
       color: white;
       padding: 20px;
       border-radius: 12px;
       text-align: center;
       box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
     }

     .metric-card h4 {
       font-size: 0.9em;
       opacity: 0.9;
       margin-bottom: 10px;
     }

     .metric-card .value {
       font-size: 2em;
       font-weight: bold;
     }

     .metrics-table-container {
       background: #2a2a2a;
       padding: 25px;
       border-radius: 15px;
       margin-bottom: 30px;
     }

     .metrics-table {
       width: 100%;
       border-collapse: collapse;
       background: #2a2a2a;
       border-radius: 8px;
       overflow: hidden;
     }

     .metrics-table th {
       background: #0052d4;
       color: white;
       padding: 12px;
       text-align: center;
       font-weight: 600;
     }

     .metrics-table td {
       padding: 12px;
       text-align: center;
       border-bottom: 1px solid #444;
     }

     .events-container {
       background: #2a2a2a;
       padding: 25px;
       border-radius: 15px;
       max-height: 400px;
       overflow-y: auto;
     }

     .event-item {
       background: #333;
       padding: 12px;
       margin-bottom: 10px;
       border-radius: 8px;
       border-left: 4px solid #4364f7;
       box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
     }

     .event-item.arrival {
       border-left-color: #10b981;
     }

     .event-item.completion {
       border-left-color: #3b82f6;
     }

     .event-item.aging {
       border-left-color: #f59e0b;
     }

     .event-item.rr_move {
       border-left-color: #8b5cf6;
     }

     .event-time {
       font-weight: bold;
       color: #6fb1fc;
       margin-right: 10px;
     }

     .loading {
       text-align: center;
       padding: 20px;
       display: none;
     }

     .loading.active {
       display: block;
     }

     .spinner {
       border: 4px solid #333;
       border-top: 4px solid #4364f7;
       border-radius: 50%;
       width: 40px;
       height: 40px;
       animation: spin 1s linear infinite;
       margin: 0 auto;
     }

     @keyframes spin {
       0% {
         transform: rotate(0deg);
       }
       100% {
         transform: rotate(360deg);
       }
     }

     .preset-buttons {
       display: flex;
       gap: 10px;
       margin-bottom: 20px;
     }
   </style>
 </head>
 <body>
   <div class="container">
     <div class="header">
       <h1>Hybrid Scheduler</h1>
       <p>Priority-Based Scheduling with Aging and Round Robin</p>
     </div>

     <div class="content">
       <!-- Priority Rule Selection -->
       <div class="priority-rule-section">
         <h3>‚öôÔ∏è Priority Rule Configuration</h3>
         <div class="radio-group">
           <div
             class="radio-option selected"
             id="option1"
             onclick="selectPriorityRule('1')"
           >
             <input
               type="radio"
               id="rule1"
               name="priority_rule"
               value="1"
               checked
             />
             <label for="rule1">Lower number = HIGHER priority</label>
           </div>
           <div
             class="radio-option"
             id="option2"
             onclick="selectPriorityRule('2')"
           >
             <input type="radio" id="rule2" name="priority_rule" value="2" />
             <label for="rule2">Higher number = HIGHER priority</label>
           </div>
         </div>
       </div>

       <div class="input-section">
         <div class="input-header">
           <h2>üìã Process Configuration</h2>
           <button class="btn btn-primary" onclick="addProcess()">
             ‚ûï Add Process
           </button>
         </div>

         <div class="preset-buttons">
           <button class="btn btn-secondary" onclick="loadSampleData()">
             Load Sample Data
           </button>
           <button class="btn btn-secondary" onclick="clearAll()">
             Clear All
           </button>
         </div>

         <table class="process-table" id="processTable">
           <thead>
             <tr>
               <th>PID</th>
               <th>Arrival Time</th>
               <th>Burst Time</th>
               <th id="priorityHeader">Priority (Lower = Higher)</th>
               <th>Action</th>
             </tr>
           </thead>
           <tbody id="processTableBody"></tbody>
         </table>

         <div style="margin-top: 20px; text-align: center">
           <button class="btn btn-success" onclick="runScheduler()">
             ‚ñ∂Ô∏è Run Scheduler
           </button>
         </div>
       </div>

       <div class="loading" id="loading">
         <div class="spinner"></div>
         <p style="margin-top: 10px; color: #6fb1fc; font-weight: bold">
           Processing...
         </p>
       </div>

       <div class="results-section" id="resultsSection">
         <div class="gantt-container">
           <h3>üìä Gantt Chart</h3>
           <div class="gantt-chart" id="ganttChart"></div>
           <div
             id="ganttLegend"
             style="
               margin-top: 15px;
               display: flex;
               flex-wrap: wrap;
               gap: 15px;
             "
           ></div>
         </div>

         <div class="metrics-grid">
           <div class="metric-card">
             <h4>Average Turnaround Time</h4>
             <div class="value" id="avgTAT">0.00</div>
           </div>
           <div class="metric-card">
             <h4>Average Waiting Time</h4>
             <div class="value" id="avgWT">0.00</div>
           </div>
           <div class="metric-card">
             <h4>Average Response Time</h4>
             <div class="value" id="avgRT">0.00</div>
           </div>
         </div>

         <div class="metrics-table-container">
           <h3 style="color: #f0f0f0; margin-bottom: 15px">
             üìà Detailed Metrics
           </h3>
           <table class="metrics-table" id="metricsTable">
             <thead>
               <tr>
                 <th>PID</th>
                 <th>AT</th>
                 <th>BT</th>
                 <th>Priority</th>
                 <th>CT</th>
                 <th>TAT</th>
                 <th>WT</th>
                 <th>RT</th>
               </tr>
             </thead>
             <tbody id="metricsTableBody"></tbody>
           </table>
         </div>

         <div class="events-container">
           <h3 style="color: #f0f0f0; margin-bottom: 15px">
             üìù Scheduling Events
           </h3>
           <div id="eventsList"></div>
         </div>
       </div>
     </div>
   </div>

   <script>
     let processCount = 0;
     const colors = [
       "#3b82f6",
       "#10b981",
       "#f59e0b",
       "#ef4444",
       "#8b5cf6",
       "#ec4899",
       "#14b8a6",
       "#f97316",
     ];

     function selectPriorityRule(rule) {
       // Update radio selection
       document.getElementById("rule" + rule).checked = true;

       // Update visual selection
       document.getElementById("option1").classList.remove("selected");
       document.getElementById("option2").classList.remove("selected");
       document.getElementById("option" + rule).classList.add("selected");

       // Update table header
       const header = document.getElementById("priorityHeader");
       if (rule === "1") {
         header.textContent = "Priority (Lower = Higher)";
       } else {
         header.textContent = "Priority (Higher = Higher)";
       }
     }

     function addProcess() {
       processCount++;
       const tbody = document.getElementById("processTableBody");
       const row = tbody.insertRow();
       row.innerHTML = `
               <td><input type="number" value="${processCount}" readonly style="background: #4a4a4a; border-color: #666;"></td>
               <td><input type="number" class="arrival-time" value="0" min="0"></td>
               <td><input type="number" class="burst-time" value="1" min="1"></td>
               <td><input type="number" class="priority" value="1" min="1"></td>
               <td><button class="delete-btn" onclick="deleteProcess(this)">üóëÔ∏è</button></td>
           `;
     }

     function deleteProcess(btn) {
       btn.closest("tr").remove();
     }

     function clearAll() {
       document.getElementById("processTableBody").innerHTML = "";
       processCount = 0;
       document.getElementById("resultsSection").style.display = "none";
     }

     function loadSampleData() {
       clearAll();
       const sampleData = [
         { arrival: 0, burst: 8, priority: 3 },
         { arrival: 2, burst: 4, priority: 2 },
         { arrival: 4, burst: 2, priority: 1 },
         { arrival: 5, burst: 6, priority: 2 },
         { arrival: 15, burst: 5, priority: 1 },
       ];

       sampleData.forEach((data) => {
         processCount++;
         const tbody = document.getElementById("processTableBody");
         const row = tbody.insertRow();
         row.innerHTML = `
                   <td><input type="number" value="${processCount}" readonly style="background: #4a4a4a; border-color: #666;"></td>
                   <td><input type="number" class="arrival-time" value="${data.arrival}" min="0"></td>
                   <td><input type="number" class="burst-time" value="${data.burst}" min="1"></td>
                   <td><input type="number" class="priority" value="${data.priority}" min="1"></td>
                   <td><button class="delete-btn" onclick="deleteProcess(this)">üóëÔ∏è</button></td>
               `;
       });
     }

     async function runScheduler() {
       const rows = document.querySelectorAll("#processTableBody tr");
       if (rows.length === 0) {
         alert("Please add at least one process!");
         return;
       }

       const processes = [];
       let valid = true;

       rows.forEach((row, index) => {
         const arrival = parseInt(row.querySelector(".arrival-time").value);
         const burst = parseInt(row.querySelector(".burst-time").value);
         const priority = parseInt(row.querySelector(".priority").value);

         if (
           isNaN(arrival) ||
           isNaN(burst) ||
           isNaN(priority) ||
           burst <= 0 ||
           arrival < 0 ||
           priority <= 0
         ) {
           alert(`Invalid input in Process ${index + 1}`);
           valid = false;
           return;
         }

         processes.push({
           pid: index + 1,
           arrival_time: arrival,
           burst_time: burst,
           priority: priority,
         });
       });

       if (!valid) return;

       // Get selected priority rule
       const priorityRule = document.querySelector(
         'input[name="priority_rule"]:checked'
       ).value;

       document.getElementById("loading").classList.add("active");
       document.getElementById("resultsSection").style.display = "none";

       try {
         const response = await fetch("/schedule", {
           method: "POST",
           headers: { "Content-Type": "application/json" },
           body: JSON.stringify({
             processes: processes,
             priority_rule: priorityRule,
           }),
         });

         const result = await response.json();

         if (result.error) {
           alert("Error: " + result.error);
           return;
         }

         displayResults(result);
       } catch (error) {
         alert("Error: " + error.message);
       } finally {
         document.getElementById("loading").classList.remove("active");
       }
     }

     function displayResults(result) {
       // Display averages
       document.getElementById("avgTAT").textContent =
         result.averages.avg_tat.toFixed(2);
       document.getElementById("avgWT").textContent =
         result.averages.avg_wt.toFixed(2);
       document.getElementById("avgRT").textContent =
         result.averages.avg_rt.toFixed(2);

       // Display Gantt chart
       const ganttChart = document.getElementById("ganttChart");
       ganttChart.innerHTML = "";

       const totalTime = result.gantt_chart[result.gantt_chart.length - 1].end;
       const pidColors = {};

       result.gantt_chart.forEach((block, index) => {
         if (!pidColors[block.pid]) {
           pidColors[block.pid] =
             colors[Object.keys(pidColors).length % colors.length];
         }

         const width = ((block.end - block.start) / totalTime) * 100;
         const div = document.createElement("div");
         div.className = "gantt-block";
         div.style.width = width + "%";
         div.style.backgroundColor = pidColors[block.pid];
         div.textContent = `P${block.pid}`;
         div.title = `P${block.pid}: ${block.start}-${block.end}`;
         ganttChart.appendChild(div);
       });

       // Display legend
       const legend = document.getElementById("ganttLegend");
       legend.innerHTML = "";
       Object.keys(pidColors).forEach((pid) => {
         const item = document.createElement("div");
         item.style.display = "flex";
         item.style.alignItems = "center";
         item.innerHTML = `
                   <div style="width: 20px; height: 20px; background: ${pidColors[pid]}; border-radius: 4px; margin-right: 8px;"></div>
                   <span style="font-weight: 600; color: #e0e0e0;">Process ${pid}</span>
               `;
         legend.appendChild(item);
       });

       // Display metrics table
       const metricsBody = document.getElementById("metricsTableBody");
       metricsBody.innerHTML = "";
       result.metrics.forEach((m) => {
         const row = metricsBody.insertRow();
         row.innerHTML = `
                   <td>${m.pid}</td>
                   <td>${m.arrival_time}</td>
                   <td>${m.burst_time}</td>
                   <td>${m.priority}</td>
                   <td>${m.completion_time}</td>
                   <td>${m.turnaround_time}</td>
                   <td>${m.waiting_time}</td>
                   <td>${m.response_time}</td>
               `;
       });

       // Display events
       const eventsList = document.getElementById("eventsList");
       eventsList.innerHTML = "";
       result.events.forEach((event) => {
         const div = document.createElement("div");
         div.className = `event-item ${event.
